<script>
/* ===========================
 *  GAS POST FIX (NO PREFLIGHT)
 *  Tek parça kopyala-yapıştır
 * =========================== */

// Eğer sayfanda zaten gidip getirmek() varsa, bunu onun ALTINA koy.
// Bu sürüm, POST'u text/plain ile yollar -> CORS preflight tetiklemez.
async function gidip_getirmek_fix(url, ayar = {}) {
  const yontem = ayar.yöntem || ayar.method || "GET";
  const govde  = ayar.vücut || ayar.body || null;

  // GET ise normal fetch
  if (String(yontem).toUpperCase() === "GET") {
    const r = await fetch(url, { method: "GET" });
    return r;
  }

  // POST (veya diğerleri): preflight olmasın diye text/plain
  const r = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: (typeof govde === "string") ? govde : JSON.stringify(govde || {})
  });
  return r;
}

/*
  Şimdi kritik hamle:
  Sayfanda "gidip getirmek(" diye bir fonksiyon çağrısı varsa
  onu değiştirmeye gerek yok; aşağıdaki satır onu otomatik yönlendirir.

  Yani var olan kod:
    gidip getirmek(UC_NOKTA, { yöntem:"POSTALAMAK", vücut: JSON.stringify(yük) })
  -> artık bu FIX fonksiyonunu kullanır.
*/
if (typeof window.gidipGetirmek === "function") {
  // Bazı dosyalarda isim böyle olabiliyor; dokunmuyoruz.
}
if (typeof gidipGetirmek === "function") {
  // dokunmuyoruz
}

// En yaygın isim: gidip_getirmek veya gidip getirmek (senin ekrandaki)
try {
  // Eğer sayfada gidip getirmek fonksiyonu tanımlıysa onu FIX'e yönlendir.
  if (typeof gidip_getirmek === "function") {
    gidip_getirmek = gidip_getirmek_fix;
  }
} catch (e) {}

try {
  if (typeof gidip === "function") {
    // dokunma
  }
} catch (e) {}

// Senin ekrandaki çağrı adı: "gidip getirmek" gibi yazılmış olabilir.
// JS'te boşluklu fonksiyon adı olmaz; ama senin projede muhtemelen minify/çeviri var.
// O yüzden en garanti çözüm: aşağıdaki global alias'ı da veriyoruz.
window.gidip_getirmek = gidip_getirmek_fix;
window.gidip_getirmek_fix = gidip_getirmek_fix;

</script>
