<!doctype html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spradon Evleri | Personel Paneli</title>
  <style>
    :root{
      --bg:#2f3e3e;
      --card:#485a5a;
      --card2:#3f4f4f;
      --txt:#f3f3f3;
      --muted:#cfd7d7;
      --btn:#b7e08a;
      --btn2:#9fb7ff;
      --danger:#ff7a7a;
      --line:rgba(255,255,255,.12);
      --shadow:0 18px 40px rgba(0,0,0,.25);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background:var(--bg);
      color:var(--txt);
      min-height:100vh;
    }
    .wrap{max-width:980px;margin:0 auto;padding:22px 16px 40px}
    .topbar{
      display:flex;gap:10px;align-items:center;justify-content:space-between;
      background:var(--card2); padding:14px 16px;border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
    .brand{font-size:22px;font-weight:800;letter-spacing:.2px}
    .right{display:flex;gap:10px;align-items:center}
    .pill{
      background:rgba(255,255,255,.12);
      border:1px solid var(--line);
      padding:9px 12px;border-radius:999px;color:var(--txt);
      font-weight:700;font-size:13px;
    }
    .btn{
      border:none;cursor:pointer;font-weight:800;
      padding:10px 14px;border-radius:12px;
    }
    .btn-primary{background:var(--btn)}
    .btn-secondary{background:var(--btn2); color:#0d1730}
    .btn-danger{background:var(--danger); color:#230909}
    .btn-ghost{
      background:transparent;border:1px solid var(--line);color:var(--txt)
    }
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:14px}
    .card{
      background:var(--card);border:1px solid var(--line);
      border-radius:var(--radius);box-shadow:var(--shadow);
      padding:16px;
    }
    .card h3{margin:0 0 10px;font-size:18px}
    .sub{color:var(--muted);font-size:13px;line-height:1.4}
    .row{
      display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:12px
    }
    .field{
      display:flex;flex-direction:column;gap:6px;min-width:170px;flex:1
    }
    label{font-size:12px;color:var(--muted)}
    input, select{
      width:100%;
      padding:10px 10px;border-radius:12px;border:1px solid var(--line);
      background:rgba(0,0,0,.12); color:var(--txt);
      outline:none;
    }
    input[readonly]{opacity:.85}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px 8px;border-bottom:1px solid var(--line);text-align:left}
    th{color:var(--muted);font-size:12px;font-weight:800}
    td{font-size:14px}
    .tag{
      display:inline-block;padding:6px 10px;border-radius:999px;
      background:rgba(0,0,0,.18);border:1px solid var(--line);
      font-size:12px;font-weight:800;color:var(--txt);
    }
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:7px 10px;border-radius:10px;font-size:12px}
    .note{
      margin-top:8px;
      background:rgba(0,0,0,.12);
      border:1px dashed rgba(255,255,255,.25);
      border-radius:12px;padding:10px 12px;color:var(--muted);font-size:13px
    }
    .warn{
      background:rgba(255,122,122,.14);
      border:1px solid rgba(255,122,122,.35);
      color:#ffecec;
    }
    .ok{
      background:rgba(183,224,138,.14);
      border:1px solid rgba(183,224,138,.35);
      color:#f4ffe8;
    }
    .hide{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">Spradon Evleri | Personel Paneli</div>
      <div class="right">
        <span class="pill" id="mePill">...</span>
        <button class="btn btn-secondary" id="securityBtn">GÃ¼venlik Bildirimi</button>
        <button class="btn btn-ghost" id="logoutBtn">Ã‡Ä±kÄ±ÅŸ</button>
      </div>
    </div>

    <div class="grid">

      <div class="card" id="adminCard">
        <h3>â• Personel Ekle</h3>
        <div class="sub">Yeni personel eklemek iÃ§in <b>Ad Soyad</b> + <b>Birim</b> seÃ§. <b>ID otomatik</b> oluÅŸur (AKIN mantÄ±ÄŸÄ±).</div>

        <div class="row" style="margin-top:14px">
          <div class="field">
            <label>ID (otomatik)</label>
            <input id="newId" type="text" readonly value="" />
          </div>
          <div class="field" style="flex:2;min-width:240px">
            <label>Ad Soyad</label>
            <input id="newName" type="text" placeholder="Ã–rn: YÃ¼ksel Kaya" />
          </div>
          <div class="field">
            <label>Birim seÃ§</label>
            <select id="newUnit">
              <option value="">â€” SeÃ§ â€”</option>
              <option value="GÃ¼venlik">GÃ¼venlik (A101â€¦)</option>
              <option value="Teknik">Teknik (K201â€¦)</option>
              <option value="Temizlik">Temizlik (I301â€¦)</option>
              <option value="Saha">Saha (N001â€¦)</option>
              <option value="YÃ¶netim">YÃ¶netim (Y001â€¦)</option>
              <option value="Muhasebe">Muhasebe (M001â€¦)</option>
            </select>
          </div>
          <div class="field" style="max-width:160px;flex:0 0 160px">
            <label>&nbsp;</label>
            <button class="btn btn-primary" id="addBtn">Ekle</button>
          </div>
        </div>

        <div class="note ok" id="adminNote">
          Åifre demo iÃ§in herkes: <b>1234</b> â€” Bu sayfada personel ekle/sil/dÃ¼zenle yetkisi sadece yÃ¶netici gruptadÄ±r.
        </div>
        <div class="note warn hide" id="noAdminNote">
          Bu hesap <b>yÃ¶netici yetkisine</b> sahip deÄŸil. Personel ekleme/silme/dÃ¼zenleme kapalÄ±.
        </div>
      </div>

      <div class="card">
        <h3>ğŸ‘¥ Personel Listesi</h3>
        <div class="sub">â€œDÃ¼zenleâ€ ile isim/birim gÃ¼ncelleyebilirsin. â€œSilâ€ ile kaydÄ± kaldÄ±rÄ±rsÄ±n.</div>

        <table>
          <thead>
            <tr>
              <th style="width:120px">ID</th>
              <th>Ad Soyad</th>
              <th style="width:170px">Birim</th>
              <th style="width:220px">Ä°ÅŸlem</th>
            </tr>
          </thead>
          <tbody id="listBody"></tbody>
        </table>

        <div class="note">
          Not: Åimdilik tÃ¼m veriler tarayÄ±cÄ±da <b>localStorage</b> ile tutulur (internet gitse bile kaybolmaz). Ä°leride â€œmerkez veriâ€ yaparÄ±z.
        </div>
      </div>

      <div class="card">
        <h3>Not</h3>
        <div class="sub">
          â€¢ Bu demo GitHub Pages Ã¼zerinde Ã§alÄ±ÅŸÄ±r.<br/>
          â€¢ ResmÃ® Ã§Ä±ktÄ± gerekirse: AkÄ±n iÃ§in resmÃ® ad <b>Kamil DurmuÅŸ</b> gÃ¶sterilecek ÅŸekilde rapor modÃ¼lÃ¼ ekleriz.<br/>
          â€¢ GÃ¼venlik bildirimleri iÃ§in â€œoffline bekleyenlerâ€ kuyruÄŸu bir sonraki adÄ±mda aÃ§Ä±lacak.
        </div>
      </div>

    </div>
  </div>

<script>
/* =========================
   1) AYARLAR / SABÄ°TLER
========================= */

// AKIN mantÄ±ÄŸÄ±: Birim â†’ ID harfi + baÅŸlangÄ±Ã§
const UNIT_RULES = {
  "GÃ¼venlik": { prefix: "A", start: 101 },
  "Teknik":   { prefix: "K", start: 201 },
  "Temizlik": { prefix: "I", start: 301 }, // TÃ¼rkÃ§e Ä° sorun Ã§Ä±karÄ±r â†’ I
  "Saha":     { prefix: "N", start: 1   },
  "YÃ¶netim":  { prefix: "Y", start: 1   },
  "Muhasebe": { prefix: "M", start: 1   },
};

// YÃ¶netici yetkisi olanlar (personel ekle/sil/dÃ¼zenle)
// Sen + MÃ¼dÃ¼r + Muhasebe (Ece Åenol) â€” IDâ€™ler varsayÄ±lan listeden eÅŸleÅŸecek.
const ADMIN_IDS = new Set(["Y001","N001","M001"]); // Seda, AkÄ±n, EciÅŸ

// ResmÃ® Ã§Ä±ktÄ± iÃ§in isim eÅŸlemesi (ÅŸimdilik not)
// Panelde â€œAkÄ±n Kamil DurmuÅŸâ€ gÃ¶rÃ¼nebilir; resmÃ® Ã§Ä±ktÄ± modÃ¼lÃ¼nde â€œKamil DurmuÅŸâ€ basarÄ±z.
const OFFICIAL_NAME_MAP = {
  // "N001": "Kamil DurmuÅŸ"  // ileride rapor modÃ¼lÃ¼nde kullanÄ±rÄ±z
};

const STORAGE_KEY_USERS = "spradon_users_v1";
const STORAGE_KEY_SEQ   = "spradon_id_seq_v1";
const STORAGE_KEY_ME    = "spradon_current_user_v1"; // index.html bunu yazÄ±yor varsayÄ±yoruz

/* =========================
   2) YARDIMCI FONKSÄ°YONLAR
========================= */
function pad3(n){
  n = Number(n || 0);
  if(n < 0) n = 0;
  if(n < 10) return "00" + n;
  if(n < 100) return "0" + n;
  return String(n);
}
function safeTrim(s){ return (s || "").toString().trim(); }

function loadSeq(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY_SEQ) || "{}"); }
  catch{ return {}; }
}
function saveSeq(seq){
  localStorage.setItem(STORAGE_KEY_SEQ, JSON.stringify(seq));
}

function loadUsers(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY_USERS) || "{}"); }
  catch{ return {}; }
}
function saveUsers(users){
  localStorage.setItem(STORAGE_KEY_USERS, JSON.stringify(users));
}

function ensureSeed(){
  const users = loadUsers();
  if(Object.keys(users).length > 0) return; // zaten var

  // VarsayÄ±lan baÅŸlangÄ±Ã§ listesi (senin verdiÄŸin â€œÅŸu anlÄ±kâ€ ekip)
  // IDâ€™ler AKIN kuralÄ±na gÃ¶re:
  // YÃ¶netim: Y001 Seda
  // Saha: N001 AkÄ±n, N002 Ä°hsan, N003 Celal
  // GÃ¼venlik: A101 Serkan, A102 Besna
  // Teknik: K201 Murat, K202 Selman
  // Temizlik: I301 YÃ¼ksel, I302 Timur
  const seed = {
    "Y001": { name: "Seda Zeybek", unit: "YÃ¶netim" },
    "N001": { name: "AkÄ±n Kamil DurmuÅŸ", unit: "Saha" },
    "N002": { name: "Ä°hsan AyÃ§i", unit: "Saha" },
    "N003": { name: "Celal Ä°nce", unit: "Saha" },
    "A101": { name: "Serkan Keskin", unit: "GÃ¼venlik" },
    "A102": { name: "Besna Karaduman", unit: "GÃ¼venlik" },
    "K201": { name: "Murat Alp", unit: "Teknik" },
    "K202": { name: "Selman", unit: "Teknik" },
    "I301": { name: "YÃ¼ksel", unit: "Temizlik" },
    "I302": { name: "Timur Kul", unit: "Temizlik" },
    "M001": { name: "Ece Åenol", unit: "Muhasebe" },
  };

  saveUsers(seed);

  // SayaÃ§larÄ± da ileride Ã§akÄ±ÅŸmayacak ÅŸekilde kur
  const seq = {};
  for(const unit in UNIT_RULES){
    const {prefix, start} = UNIT_RULES[unit];
    // mevcut en yÃ¼ksek IDâ€™yi bul
    let maxNum = start - 1;
    for(const id of Object.keys(seed)){
      if(id.startsWith(prefix)){
        const num = parseInt(id.slice(1), 10);
        if(!isNaN(num)) maxNum = Math.max(maxNum, num);
      }
    }
    seq[prefix] = maxNum + 1; // bir sonraki
  }
  saveSeq(seq);
}

function getMe(){
  // index.html â€œcurrent userâ€ saklamÄ±yorsa bile sayfa Ã§alÄ±ÅŸsÄ±n diye:
  // querystring ile ?id=N001 gibi geleni de destekleyelim.
  const url = new URL(location.href);
  const qid = url.searchParams.get("id");
  if(qid) return { id: qid };

  try{
    const me = JSON.parse(localStorage.getItem(STORAGE_KEY_ME) || "null");
    if(me && me.id) return me;
  }catch{}
  return null;
}

function setMePill(me, users){
  if(!me || !me.id || !users[me.id]){
    document.getElementById("mePill").textContent = "Misafir";
    return;
  }
  document.getElementById("mePill").textContent =
    me.id + " Â· " + users[me.id].name + " Â· " + users[me.id].unit;
}

function isAdmin(me){
  return me && me.id && ADMIN_IDS.has(me.id);
}

function nextIdForUnit(unit){
  const rule = UNIT_RULES[unit];
  if(!rule) return "";
  const seq = loadSeq();
  const prefix = rule.prefix;

  // ilk kez yoksa startâ€™tan baÅŸlat
  if(typeof seq[prefix] !== "number"){
    seq[prefix] = rule.start;
  }
  // Saha/YÃ¶netim/Muhasebe start=1 ise N001 gibi Ã¼retmek iÃ§in +pad3
  const id = prefix + pad3(seq[prefix]);
  return id;
}

function commitNextId(unit){
  const rule = UNIT_RULES[unit];
  if(!rule) return null;
  const seq = loadSeq();
  const prefix = rule.prefix;
  if(typeof seq[prefix] !== "number"){
    seq[prefix] = rule.start;
  }
  const id = prefix + pad3(seq[prefix]);
  seq[prefix] = seq[prefix] + 1;
  saveSeq(seq);
  return id;
}

function renderList(users, canEdit){
  const body = document.getElementById("listBody");
  body.innerHTML = "";

  const ids = Object.keys(users).sort((a,b)=> a.localeCompare(b));
  if(ids.length === 0){
    const tr = document.createElement("tr");
    tr.innerHTML = <td colspan="4" style="color:#cfd7d7">KayÄ±t yok.</td>;
    body.appendChild(tr);
    return;
  }

  for(const id of ids){
    const u = users[id];
    const tr = document.createElement("tr");

    const actions = canEdit ? `
      <div class="actions">
        <button class="btn btn-secondary small" data-act="edit" data-id="${id}">DÃ¼zenle</button>
        <button class="btn btn-danger small" data-act="del" data-id="${id}">Sil</button>
      </div>
    ` : <span class="tag">Sadece gÃ¶rÃ¼ntÃ¼leme</span>;

    tr.innerHTML = `
      <td><span class="tag">${id}</span></td>
      <td>${escapeHtml(u.name || "")}</td>
      <td>${escapeHtml(u.unit || "")}</td>
      <td>${actions}</td>
    `;
    body.appendChild(tr);
  }
}

function escapeHtml(s){
  return (s || "").toString()
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#39;");
}

/* =========================
   3) SAYFA BAÅLAT
========================= */
ensureSeed();

const users = loadUsers();
const me = getMe();
setMePill(me, users);

const canEdit = isAdmin(me);

// Admin kartÄ± aÃ§/kapat
document.getElementById("adminCard").classList.toggle("hide", !canEdit);
document.getElementById("noAdminNote").classList.toggle("hide", canEdit);
document.getElementById("adminNote").classList.toggle("hide", !canEdit);

// Ä°lk liste bas
renderList(users, canEdit);

// Birim seÃ§ilince ID otomatik gÃ¶ster
const newUnitEl = document.getElementById("newUnit");
const newIdEl = document.getElementById("newId");

function refreshAutoId(){
  const unit = newUnitEl.value;
  newIdEl.value = unit ? nextIdForUnit(unit) : "";
}
newUnitEl.addEventListener("change", refreshAutoId);
refreshAutoId();

// Ekle butonu
document.getElementById("addBtn").addEventListener("click", ()=>{
  if(!canEdit){ alert("Bu hesap yÃ¶netici deÄŸil."); return; }

  const unit = safeTrim(newUnitEl.value);
  const name = safeTrim(document.getElementById("newName").value);

  if(!unit){ alert("Birim seÃ§."); return; }
  if(!name){ alert("Ad Soyad gir."); return; }

  const id = commitNextId(unit);
  if(!id){ alert("ID Ã¼retilemedi."); return; }

  const usersNow = loadUsers();
  if(usersNow[id]){
    // Ã§ok nadir: seq Ã§akÄ±ÅŸmasÄ±
    alert("ID Ã§akÄ±ÅŸtÄ±. SayfayÄ± yenileyip tekrar dene.");
    return;
  }
  usersNow[id] = { name, unit };
  saveUsers(usersNow);

  document.getElementById("newName").value = "";
  refreshAutoId();
  renderList(usersNow, canEdit);
});

// Liste edit/sil
document.getElementById("listBody").addEventListener("click", (e)=>{
  const btn = e.target.closest("button");
  if(!btn) return;
  if(!canEdit){ alert("Bu hesap yÃ¶netici deÄŸil."); return; }

  const act = btn.getAttribute("data-act");
  const id = btn.getAttribute("data-id");
  if(!act || !id) return;

  const usersNow = loadUsers();
  const u = usersNow[id];
  if(!u){ alert("KayÄ±t bulunamadÄ±."); return; }

  if(act === "del"){
    const ok = confirm(id + " (" + u.name + ") silinsin mi?");
    if(!ok) return;
    delete usersNow[id];
    saveUsers(usersNow);
    renderList(usersNow, canEdit);
    return;
  }

  if(act === "edit"){
    const newName = safeTrim(prompt("Yeni Ad Soyad:", u.name));
    if(!newName) return;

    const newUnit = safeTrim(prompt("Yeni Birim (GÃ¼venlik/Teknik/Temizlik/Saha/YÃ¶netim/Muhasebe):", u.unit));
    if(!newUnit) return;
    if(!UNIT_RULES[newUnit]){
      alert("Birim hatalÄ±. Åunlardan biri olmalÄ±: GÃ¼venlik, Teknik, Temizlik, Saha, YÃ¶netim, Muhasebe");
      return;
    }

    // ID deÄŸiÅŸmiyor (kural: ID sabit)
    usersNow[id] = { name: newName, unit: newUnit };
    saveUsers(usersNow);
    renderList(usersNow, canEdit);
    return;
  }
});

// Ã‡Ä±kÄ±ÅŸ
document.getElementById("logoutBtn").addEventListener("click", ()=>{
  // current user temizle
  localStorage.removeItem(STORAGE_KEY_ME);
  location.href = "./index.html";
});

// GÃ¼venlik bildirimi sayfasÄ±na git
document.getElementById("securityBtn").addEventListener("click", ()=>{
  location.href = "./security.html";
});
</script>
</body>
</html>
